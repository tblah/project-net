<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="rustdoc">
    <meta name="description" content="API documentation for the Rust `symmetric` mod in crate `proj_crypto`.">
    <meta name="keywords" content="rust, rustlang, rust-lang, symmetric">

    <title>proj_crypto::symmetric - Rust</title>

    <link rel="stylesheet" type="text/css" href="../../rustdoc.css">
    <link rel="stylesheet" type="text/css" href="../../main.css">
    

    
    
</head>
<body class="rustdoc">
    <!--[if lte IE 8]>
    <div class="warning">
        This old browser is unsupported and will most likely display funky
        things.
    </div>
    <![endif]-->

    

    <nav class="sidebar">
        
        <p class='location'><a href='../index.html'>proj_crypto</a></p><script>window.sidebarCurrent = {name: 'symmetric', ty: 'mod', relpath: '../'};</script><script defer src="../sidebar-items.js"></script>
    </nav>

    <nav class="sub">
        <form class="search-form js-only">
            <div class="search-container">
                <input class="search-input" name="search"
                       autocomplete="off"
                       placeholder="Click or press ‘S’ to search, ‘?’ for more options…"
                       type="search">
            </div>
        </form>
    </nav>

    <section id='main' class="content mod">
<h1 class='fqn'><span class='in-band'>Module <a href='../index.html'>proj_crypto</a>::<wbr><a class='mod' href=''>symmetric</a></span><span class='out-of-band'><span id='render-detail'>
                   <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">
                       [<span class='inner'>&#x2212;</span>]
                   </a>
               </span><a class='srclink' href='../../src/proj_crypto/symmetric/mod.rs.html#1-274' title='goto source code'>[src]</a></span></h1>
<div class='docblock'><p>Symmetric encryption module.</p>

<p>This module provides an interface for symmetric (secret key) cryptography. </p>

<h1 id='cryptography' class='section-header'><a href='#cryptography'>Cryptography</a></h1>
<h2 id='ratcheting' class='section-header'><a href='#ratcheting'>Ratcheting</a></h2>
<p>For the n&#39;th message, the keys are hashed n times. The nonce is also hashed. In a system which does not allow for message loss and re-ordering, this provides forward secrecy for the symmetric keys as each key can be destroyed immediately after use. SHA-256 is used because this matches the key length of chacha20.</p>

<h2 id='secure-channel' class='section-header'><a href='#secure-channel'>Secure Channel</a></h2>
<p>Authenticates <em>first</em> with HMAC-SHA512 (only the first 256 bytes are used). This was chosen as it is the default authentication mechanism in sodiumoxide.
Then we encrypt using ChaCha20. ChaCha20 was chosen over the sodiumoxide default (xsalsa20) because I will not be using a random nonse and chacha is more resistant to crypt analysis (see it&#39;s introductory paper). The key is used from the ratcheting system.</p>

<h1 id='example-encrypted-authentication' class='section-header'><a href='#example-encrypted-authentication'>Example (Encrypted Authentication)</a></h1>
<pre class='rust rust-example-rendered'>
<span class='kw'>use</span> <span class='ident'>sodiumoxide</span>::<span class='ident'>randombytes</span>;
<span class='kw'>use</span> <span class='ident'>std</span>::<span class='ident'>str</span>;
 
<span class='ident'>sodiumoxide</span>::<span class='ident'>init</span>();
<span class='kw'>let</span> <span class='ident'>message</span> <span class='op'>=</span> <span class='string'>&quot;hello world!&quot;</span>;
<span class='kw'>let</span> <span class='ident'>k_e</span> <span class='op'>=</span> <span class='kw-2'>&amp;</span><span class='ident'>randombytes</span>::<span class='ident'>randombytes</span>(<span class='number'>32</span>);
<span class='kw'>let</span> <span class='ident'>k_a</span> <span class='op'>=</span> <span class='kw-2'>&amp;</span><span class='ident'>randombytes</span>::<span class='ident'>randombytes</span>(<span class='number'>32</span>);
<span class='kw'>let</span> <span class='ident'>message_number</span>: <span class='ident'>u16</span> <span class='op'>=</span> <span class='number'>0</span>;

<span class='kw'>let</span> <span class='kw-2'>mut</span> <span class='ident'>state</span> <span class='op'>=</span> <span class='ident'>State</span>::<span class='ident'>new</span>(<span class='ident'>k_e</span>, <span class='ident'>k_a</span>);
<span class='kw'>let</span> <span class='ident'>ciphertext</span> <span class='op'>=</span> <span class='ident'>state</span>.<span class='ident'>authenticated_encryption</span>(<span class='ident'>message</span>.<span class='ident'>as_bytes</span>(), <span class='ident'>message_number</span>);
<span class='kw'>let</span> <span class='ident'>plaintext</span> <span class='op'>=</span> <span class='ident'>state</span>.<span class='ident'>authenticated_decryption</span>(<span class='kw-2'>&amp;</span><span class='ident'>ciphertext</span>, <span class='ident'>message_number</span>).<span class='ident'>unwrap</span>();

<span class='macro'>assert_eq</span><span class='macro'>!</span>(<span class='ident'>message</span>, <span class='ident'>str</span>::<span class='ident'>from_utf8</span>(<span class='kw-2'>&amp;</span><span class='ident'>plaintext</span>).<span class='ident'>unwrap</span>());

<span class='comment'>// some stuff happens. Now we no-longer need keys for messages numbered less than 8</span>

<span class='ident'>state</span>.<span class='ident'>increase_iter_to</span>(<span class='number'>8</span>);

<span class='comment'>// crypto still works for message numbers starting from 8:</span>
<span class='kw'>let</span> <span class='ident'>ciphertext8</span> <span class='op'>=</span> <span class='ident'>state</span>.<span class='ident'>authenticated_encryption</span>(<span class='ident'>message</span>.<span class='ident'>as_bytes</span>(), <span class='number'>8</span>);
<span class='kw'>let</span> <span class='ident'>plaintext8</span> <span class='op'>=</span> <span class='ident'>state</span>.<span class='ident'>authenticated_decryption</span>(<span class='kw-2'>&amp;</span><span class='ident'>ciphertext8</span>, <span class='number'>8</span>).<span class='ident'>unwrap</span>();

<span class='macro'>assert_eq</span><span class='macro'>!</span>(<span class='ident'>message</span>, <span class='ident'>str</span>::<span class='ident'>from_utf8</span>(<span class='kw-2'>&amp;</span><span class='ident'>plaintext8</span>).<span class='ident'>unwrap</span>());</pre>

<h1 id='example-plain-authentication' class='section-header'><a href='#example-plain-authentication'>Example (Plain Authentication)</a></h1>
<pre class='rust rust-example-rendered'>
<span class='kw'>use</span> <span class='ident'>sodiumoxide</span>::<span class='ident'>randombytes</span>;
<span class='kw'>use</span> <span class='ident'>std</span>::<span class='ident'>str</span>;
 
<span class='ident'>sodiumoxide</span>::<span class='ident'>init</span>();
<span class='kw'>let</span> <span class='ident'>message</span> <span class='op'>=</span> <span class='string'>&quot;hello world!&quot;</span>.<span class='ident'>as_bytes</span>();
<span class='kw'>let</span> <span class='ident'>k_e</span> <span class='op'>=</span> <span class='kw-2'>&amp;</span><span class='ident'>randombytes</span>::<span class='ident'>randombytes</span>(<span class='number'>32</span>);
<span class='kw'>let</span> <span class='ident'>k_a</span> <span class='op'>=</span> <span class='kw-2'>&amp;</span><span class='ident'>randombytes</span>::<span class='ident'>randombytes</span>(<span class='number'>32</span>);
<span class='kw'>let</span> <span class='ident'>message_number</span>: <span class='ident'>u16</span> <span class='op'>=</span> <span class='number'>0</span>;

<span class='kw'>let</span> <span class='kw-2'>mut</span> <span class='ident'>state</span> <span class='op'>=</span> <span class='ident'>State</span>::<span class='ident'>new</span>(<span class='ident'>k_e</span>, <span class='ident'>k_a</span>);
<span class='kw'>let</span> <span class='ident'>state</span> <span class='op'>=</span> <span class='ident'>State</span>::<span class='ident'>new</span>(<span class='ident'>k_e</span>, <span class='ident'>k_a</span>);
<span class='kw'>let</span> <span class='ident'>auth_tag</span> <span class='op'>=</span> <span class='ident'>state</span>.<span class='ident'>plain_auth_tag</span>(<span class='ident'>message</span>, <span class='ident'>message_number</span>);

<span class='macro'>assert</span><span class='macro'>!</span>( <span class='ident'>state</span>.<span class='ident'>verify_auth_tag</span>(<span class='kw-2'>&amp;</span><span class='ident'>auth_tag</span>, <span class='ident'>message</span>, <span class='ident'>message_number</span>) );</pre>
</div><h2 id='structs' class='section-header'><a href="#structs">Structs</a></h2>
<table>
                       <tr class=' module-item'>
                           <td><a class='struct' href='struct.Digest.html'
                                  title='proj_crypto::symmetric::Digest'>Digest</a></td>
                           <td class='docblock-short'>
                                <p>A wrapper around sha256::Digest so that we can implement Drop on it to clean up the memory when it goes out of scope.
This is necessary because often our shared secret keys are sha256 digests.</p>
                           </td>
                       </tr>
                       <tr class=' module-item'>
                           <td><a class='struct' href='struct.State.html'
                                  title='proj_crypto::symmetric::State'>State</a></td>
                           <td class='docblock-short'>
                                <p>Stores the state of the symmetric encryption system.
Memory is zeroed when this goes out of scope</p>
                           </td>
                       </tr></table><h2 id='constants' class='section-header'><a href="#constants">Constants</a></h2>
<table>
                       <tr class=' module-item'>
                           <td><a class='constant' href='constant.AUTH_TAG_BYTES.html'
                                  title='proj_crypto::symmetric::AUTH_TAG_BYTES'>AUTH_TAG_BYTES</a></td>
                           <td class='docblock-short'>
                                <p>The length of an authentication tag in bytes</p>
                           </td>
                       </tr></table></section>
    <section id='search' class="content hidden"></section>

    <section class="footer"></section>

    <aside id="help" class="hidden">
        <div>
            <h1 class="hidden">Help</h1>

            <div class="shortcuts">
                <h2>Keyboard Shortcuts</h2>

                <dl>
                    <dt>?</dt>
                    <dd>Show this help dialog</dd>
                    <dt>S</dt>
                    <dd>Focus the search field</dd>
                    <dt>&larrb;</dt>
                    <dd>Move up in search results</dd>
                    <dt>&rarrb;</dt>
                    <dd>Move down in search results</dd>
                    <dt>&#9166;</dt>
                    <dd>Go to active search result</dd>
                    <dt>+</dt>
                    <dd>Collapse/expand all sections</dd>
                </dl>
            </div>

            <div class="infos">
                <h2>Search Tricks</h2>

                <p>
                    Prefix searches with a type followed by a colon (e.g.
                    <code>fn:</code>) to restrict the search to a given type.
                </p>

                <p>
                    Accepted types are: <code>fn</code>, <code>mod</code>,
                    <code>struct</code>, <code>enum</code>,
                    <code>trait</code>, <code>type</code>, <code>macro</code>,
                    and <code>const</code>.
                </p>

                <p>
                    Search functions by type signature (e.g.
                    <code>vec -> usize</code> or <code>* -> vec</code>)
                </p>
            </div>
        </div>
    </aside>

    

    <script>
        window.rootPath = "../../";
        window.currentCrate = "proj_crypto";
    </script>
    <script src="../../jquery.js"></script>
    <script src="../../main.js"></script>
    <script defer src="../../search-index.js"></script>
</body>
</html>